# 画像認識アプリケーション 要件定義書

## 1. プロジェクト概要

ユーザーがスマートフォンやPCから画像をアップロードし、AI（機械学習モデル）が画像内の物体を自動で検出し、その名称や位置を特定するアプリケーションを開発する。

## 2. ターゲットユーザー

- 一般ユーザー（身の回りの物の名前を知りたい）
- 業務利用（在庫管理や検品作業の効率化を目指す担当者）

## 3. 機能要件

### 3.1 画像入力
- **ファイルアップロード**: 端末内の画像ファイル（JPG, PNG）を選択してアップロード
- **カメラ連携**: アプリ内からカメラを起動し、撮影した画像をそのまま解析

### 3.2 解析・認識
- **オブジェクト検出**: 画像内の複数の物体を検出し、バウンディングボックス（枠）で囲む
- **ラベル表示**: 検出された物体の名称（例：車、犬、椅子）と信頼度（%）を表示

### 3.3 結果表示
- **解析履歴保存**: 過去に解析した画像と結果をリスト形式で表示
- **結果共有**: 解析結果（画像＋テキスト）をSNSやメールで共有

### 3.4 ユーザー管理
- **アカウント作成**: 履歴保存や同期のための会員登録・ログイン機能

## 4. 非機能要件

### 4.1 パフォーマンス
- 画像アップロードから解析結果表示まで3秒以内を目指す

### 4.2 スケーラビリティ
- 同時接続ユーザーが増えても解析サーバーがダウンしない構成

### 4.3 可用性
- 24時間365日利用可能であること

### 4.4 セキュリティ
- アップロードされた画像に個人情報が含まれる可能性を考慮し、通信を暗号化（SSL/TLS）する

## 5. 技術スタック

### 5.1 フロントエンド
- **フレームワーク**: React
- **言語**: TypeScript
- **UIライブラリ**: Material-UI または Tailwind CSS

### 5.2 バックエンド
- **フレームワーク**: FastAPI
- **言語**: Python 3.9+

### 5.3 AI/MLモデル
- **モデル**: YOLOv8（ultralytics）
- **フレームワーク**: PyTorch（YOLOv8の依存関係として）

### 5.4 データベース
- **開発環境**: SQLite
- **本番環境**: PostgreSQL（将来的な拡張を考慮）

### 5.5 認証
- **方式**: JWT (JSON Web Token)
- **パスワードポリシー**: 最小8文字、一般的な入力文字

### 5.6 インフラ
- **ストレージ**: AWS S3（画像保存）
- **ローカル開発**: ローカルファイルシステム（開発用）

## 6. 詳細仕様

### 6.1 画像制限
- **最大ファイルサイズ**: 10MB
- **最大画像サイズ**: 挙動に支障が出ない範囲であれば上限なし（大きすぎる場合はエラーを返す）
- **対応フォーマット**: JPG, PNG

### 6.2 データベース設計

#### 6.2.1 usersテーブル
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 6.2.2 detection_historyテーブル
```sql
CREATE TABLE detection_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    image_path VARCHAR(500) NOT NULL,
    detection_results TEXT NOT NULL,  -- JSON形式で保存
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### 6.3 API仕様

#### 6.3.1 認証エンドポイント
- `POST /api/auth/register` - ユーザー登録
- `POST /api/auth/login` - ログイン
- `POST /api/auth/refresh` - トークンリフレッシュ

#### 6.3.2 画像解析エンドポイント
- `POST /api/detect` - 画像アップロードと解析
- `GET /api/history` - 解析履歴取得
- `GET /api/history/{id}` - 特定の履歴詳細取得
- `DELETE /api/history/{id}` - 履歴削除

### 6.4 エラーハンドリング
- **エラー通知**: 検出結果としてブラウザ上で返す
- **ログ**: error以上のログを10日間保持

### 6.5 テスト要件
- 単体テスト: 各機能の個別テスト
- 統合テスト: APIエンドポイントの統合テスト
- テストカバレッジ: 80%以上を目標

## 7. 画面遷移図

1. **ホーム画面**: 「画像を選択」ボタン
2. **解析中画面**: ローディングアニメーション
3. **結果画面**: 画像上に枠とラベルが表示される
4. **履歴一覧画面**: 過去の解析データ
5. **ログイン画面**: ユーザー認証
6. **登録画面**: 新規ユーザー登録

## 8. 開発環境

### 8.1 必要な環境
- Python 3.9以上
- Node.js 18以上
- npm または yarn

### 8.2 ローカル開発環境
- バックエンド: FastAPI開発サーバー（uvicorn）
- フロントエンド: React開発サーバー（Vite）
- データベース: SQLite（ローカルファイル）
- 画像ストレージ: ローカルファイルシステム（開発用）

## 9. デプロイ

### 9.1 本番環境
- **バックエンド**: AWS EC2 または AWS Lambda
- **フロントエンド**: AWS S3 + CloudFront
- **データベース**: AWS RDS (PostgreSQL)
- **画像ストレージ**: AWS S3
- **認証**: JWT（バックエンドで管理）

## 10. セキュリティ考慮事項

- パスワードはbcryptでハッシュ化
- JWTトークンは有効期限を設定
- 画像アップロード時のファイルタイプ検証
- CORS設定の適切な管理
- レート制限（API abuse防止）
